/**
 * Social Likes
 * http://sapegin.github.com/social-likes
 *
 * Sharing buttons for Russian and worldwide social networks.
 * jQuery removed, only requires simple utilities: GET, onDomReady, http_build_query, addListener, removeListener
 *
 * @author Artem Sapegin, Vitaliy Filippov
 * @copyright 2014 Artem Sapegin (sapegin.me), 2016 Vitaliy Filippov
 * @license MIT
 */
document.addEventListener("DOMContentLoaded",(function(){setTimeout((()=>{!function(){"use strict";var t="mbr-social-likes",e=t+"__",i=t+"_opened",n="https:"===location.protocol?"https:":"http:";function o(t,e,i){for(var n=-1,o=!1;-1!=(n=t.className.indexOf(e,n+1));)n&&!/\s/.exec(t.className.charAt(n-1))||n!=t.className.length-e.length&&!/\s/.exec(t.className.charAt(n+e.length))||(o=!0,i&&(t.className=t.className.substr(0,n-1)+t.className.substr(n+e.length)));return o}function r(t,e,i){var n=document.createElement("script");n.type="text/javascript",n.src=t,n.onreadystatechange=function(){"complete"==n.readyState?e&&e():"loaded"==n.readyState&&(n.children,"loading"==n.readyState&&i&&i()),n.parentNode&&n.parentNode.removeChild(n),n=null},n.onload=function(){e&&e(),n.parentNode&&n.parentNode.removeChild(n),n=null},n.onerror=function(){i&&i(),n.parentNode&&n.parentNode.removeChild(n),n=null},(document.head||document.getElementsByTagName("head")[0]).appendChild(n)}var s={facebook:{counterUrl:"https://graph.facebook.com/fql?q=SELECT+total_count+FROM+link_stat+WHERE+url%3D%22{url}%22&callback=?",convertNumber:function(t){return t.data[0].total_count},popupUrl:"https://www.facebook.com/sharer/sharer.php?u={url}",popupWidth:600,popupHeight:359},twitter:{popupUrl:"https://twitter.com/intent/tweet?url={url}&text={title}",popupWidth:600,popupHeight:250,click:function(){return/[\.\?:\-–—]\s*$/.test(this.options.title)||(this.options.title+=":"),!0}},mailru:{counterUrl:n+"//connect.mail.ru/share_count?url_list={url}&callback=1&func=?",convertNumber:function(t){for(var e in t)if(t.hasOwnProperty(e))return t[e].shares},popupUrl:"https://connect.mail.ru/share?share_url={url}&title={title}&image_url={image}",popupWidth:492,popupHeight:500},vkontakte:{counterUrl:"https://vk.com/share.php?act=count&url={url}&index={index}",counter:function(t,e){var i=s.vkontakte;i._||(i._=[],window.VK||(window.VK={}),window.VK.Share={count:function(t,e){i._[t].resolve(e)}});var n=i._.length;i._.push(e),r(h(t,{index:n}),null,(function(){e.reject()}))},popupUrl:"https://vk.com/share.php?url={url}&title={title}&image={image}",popupWidth:655,popupHeight:450},odnoklassniki:{counterUrl:n+"//connect.ok.ru/dk?st.cmd=extLike&ref={url}&uid={index}",counter:function(t,e){var i=s.odnoklassniki;i._||(i._=[],window.ODKL||(window.ODKL={}),window.ODKL.updateCount=function(t,e){t&&i._[t].resolve(e)});var n=i._.length;i._.push(e),r(h(t,{index:n}),null,(function(){e.reject()}))},popupUrl:"https://connect.ok.ru/dk?st.cmd=WidgetSharePreview&service=odnoklassniki&st.shareUrl={url}",popupWidth:580,popupHeight:336},plusone:{counterUrl:n+"//share.yandex.ru/gpp.xml?url={url}&callback=?",convertNumber:function(t){return parseInt(t.replace(/\D/g,""),10)},popupUrl:"https://plus.google.com/share?url={url}",popupWidth:500,popupHeight:550},pinterest:{counterUrl:n+"//api.pinterest.com/v1/urls/count.json?url={url}&callback=?",convertNumber:function(t){return t.count},popupUrl:"https://pinterest.com/pin/create/button/?url={url}&description={title}",popupWidth:740,popupHeight:550}},a={promises:{},fetch:function(t,e,i){a.promises[t]||(a.promises[t]={});var n=a.promises[t];if(!i.forceUpdate&&n[e])return n[e];var o={};for(var u in s[t])o[u]=s[t][u];for(u in i)o[u]=i[u];var c={resolve:function(t){},reject:function(){}},l=o.counterUrl&&h(o.counterUrl,{url:e});if(l&&"function"==typeof o.counter)o.counter(l,c);else if(o.counterUrl){var p=function(t){try{"function"==typeof o.convertNumber&&(t=o.convertNumber(t)),c.resolve(t)}catch(t){c.reject()}};if(l.indexOf("=?")>0){for(var d=0;window["__jsonp"+d];)d++;window["__jsonp"+d]=function(t){delete window["__jsonp"+d],p(t)},r(l=l.replace("=?","=__jsonp"+d),null,(function(){c.reject()}))}else GET(l,(function(t,e){t.responseText?p(e||t.responseText):c.reject()}))}else c.reject();return n[e]=c,n[e]}};window.socialLikes=function(e,i){var n=e["__"+t];if(n)"object"==typeof i&&n.update(i);else{var o={},r=p(e);for(var s in window.socialLikes.defaults)o[s]=window.socialLikes.defaults[s];for(s in i)o[s]=i[s];for(s in r)o[s]=r[s];n=new c(e,o),e["__"+t]=n}};var u=function(){for(var t={},e=document.getElementsByTagName("meta"),i=0;i<e.length;i++){var n=e[i].getAttribute("property");n&&"og:"==n.substr(0,3)&&(t[n.substr(3)]=e[i].getAttribute("content"))}return t}();function c(t,e){this.container=t,this.options=e,this.init()}function l(t,e){for(var i in this.widget=t,this.options={},e)this.options[i]=e[i];this.detectService(),this.service&&this.init()}function p(t,e){function i(t,e){return e.toUpper()}for(var n={},o=0;o<t.attributes.length;o++){var r=t.attributes[o].name;if("data-"==r.substr(0,5)){r=r.substr(5);var s=t.attributes[o].value;"yes"===s?s=!0:"no"===s&&(s=!1),n[e?r:r.replace(/-(\w)/g,i)]=s}}return n}function h(t,e){return function(t,e,i){return t.replace(/\{([^\}]+)\}/g,(function(t,n){return n in e?i?i(e[n]):e[n]:t}))}(t,e,encodeURIComponent)}function d(t,i){var n=e+t;return n+" "+n+"_"+i}window.socialLikes.defaults={url:window.location.href.replace(window.location.hash,""),title:u.title||document.title,image:u.image,counters:!0,zeroes:!1,wait:500,timeout:1e4,popupCheckInterval:500,singleTitle:"Share"},c.prototype={init:function(){var e=this;o(this.container,t)||(this.container.className+=" "+t),this.single=o(this.container,t+"_single"),this.initUserButtons(),this.countersLeft=0,this.number=0,this.container["on_counter."+t]=function(t){return e.updateCounter(t)},this.makeSingleButton(),this.buttons=[];for(var i=0;i<this.container.children.length;i++){var n=new l(this.container.children[i],this.options);this.buttons.push(n),n.options.counterUrl&&this.countersLeft++}this.options.counters?(this.timer=setTimeout((function(){e.appear()}),this.options.wait),this.timeout=setTimeout((function(){e.ready()}),this.options.timeout)):this.appear()},initUserButtons:function(){if(!this.userButtonInited&&window.socialLikesButtons)for(var t in window.socialLikesButtons)for(var e in s[t]=s[t]||{},window.socialLikesButtons[t])s[t][e]=window.socialLikesButtons[t][e];this.userButtonInited=!0},makeSingleButton:function(){if(this.single){var e=this.container;e.className+=" "+t+"_vertical";var n=document.createElement("div");n.className=t+"_single-w",e.parentNode.insertBefore(n,e),n.appendChild(e);var r=document.createElement("div");for(r.className=t+"__single-container";e.firstChild;)r.appendChild(e.firstChild);e.appendChild(r);var s=document.createElement("div");s.className=d("widget","single"),s.innerHTML='<div class="'+d("button","single")+'"><span class="'+d("icon","single")+'"></span>'+this.options.singleTitle+"</div>",n.appendChild(s),addListener(s,"click",(function(){var n=t+"__widget_active";return o(s,n,!0)?o(e,i,!0):(s.className+=" "+n,e.style.left=(s.offsetWidth-e.offsetWidth)/2+"px",e.style.top=-e.offsetHeight+"px",function(t){var e=10;if(document.documentElement.getBoundingClientRect){var n=parseInt(t.style.left,10),o=parseInt(t.style.top,10),r=t[0].getBoundingClientRect();r.left<e?t.stype.left=e-r.left+n+"px":r.right>window.innerWidth-e&&(t.style.left=window.innerWidth-r.right-e+n+"px"),r.top<e?t.style.top=e-r.top+o+"px":r.bottom>window.innerHeight-e&&(t.style.top=window.innerHeight-r.bottom-e+o+"px")}t.className+=" "+i}(e),function(t,e){function n(r){if("keydown"!==r.type||27===r.which){for(var s=r;s&&s!=t;s=s.parentNode);s!=t&&(o(t,i,!0),removeListener(document,"click",n),removeListener(document,"touchstart",n),removeListener(document,"keydown",n),e())}}addListener(document,"click",n),addListener(document,"touchstart",n),addListener(document,"keydown",n)}(e,(function(){o(s,n,!0)}))),!1})),this.widget=s}},update:function(e){if(e.forceUpdate||e.url!==this.options.url){if(this.number=0,this.countersLeft=this.buttons.length,this.widget){var i=this.widget.querySelector("."+t+"__counter");i&&i.parentNode.removeChild(i)}for(var n in e)this.options[n]=e[n];for(var o=0;o<this.buttons.length;o++)this.buttons[o].update(e)}},updateCounter:function(t,e,i){((i=i||0)||this.options.zeroes)&&(this.number+=i,this.single&&this.getCounterElem().text(this.number)),0===this.countersLeft&&(this.appear(),this.ready()),this.countersLeft--},appear:function(){this.container.className+=" "+t+"_visible"},ready:function(e){if(this.timeout&&clearTimeout(this.timeout),this.container.className+=" "+t+"_ready",!e){var i=this.container["on_ready."+t];i&&i(this.number)}},getCounterElem:function(){var t=this.widget.querySelector("."+e+"counter_single");return t.length||((t=document.createElement("span")).className=d("counter","single"),this.widget.append(t)),t}},l.prototype={init:function(){this.detectParams(),this.initHtml();var t=this;setTimeout((function(){t.initCounter()}),0)},update:function(e){for(var i in this.options.forceUpdate=!1,e)this.options[i]=e[i];var n=this.widget.querySelector("."+t+"__counter");n&&n.parentNode.removeChild(n),this.initCounter()},detectService:function(){var t=this.widget.getAttribute("data-service");if(!t){for(var e=this.widget.classList||this.widget.className.split(" "),i=0;i<e.length;i++){var n=e[i];if(s[n]){t=n;break}}if(!t)return}for(var o in this.service=t,s[t])this.options[o]=s[t][o]},detectParams:function(){var t=this.widget.getAttribute("data-counter");if(t){var e=parseInt(t,10);isNaN(e)?this.options.counterUrl=t:this.options.counterNumber=e}(t=this.widget.getAttribute("data-title"))&&(this.options.title=t),(t=this.widget.getAttribute("data-url"))&&(this.options.url=t)},initHtml:function(){var t=this,e=this.options,i=this.widget,n=i.querySelector("a");n&&this.cloneDataAttrs(n,i);var o=document.createElement("span");if(o.className=this.getElementClassNames("button"),o.innerHTML=i.innerHTML,e.clickUrl){var r=h(e.clickUrl,{url:e.url,title:e.title,image:e.image||""}),s=document.createElement("a");s.href=r,this.cloneDataAttrs(i,s),i.parentNode.insertBefore(s,i),i.parentNode.removeChild(i),this.widget=i=s}else i.addEventListener("click",(function(){t.click()}));i.className=i.className.replace(" "+this.service,"")+" "+this.getElementClassNames("widget");var a=document.createElement("span");a.className=this.getElementClassNames("icon"),o.children.length?o.insertBefore(a,o.firstChild):o.appendChild(a),i.innerHTML="",i.appendChild(o),this.button=o},initCounter:function(){if(this.options.counters)if(this.options.counterNumber)this.updateCounter(this.options.counterNumber);else{var t={counterUrl:this.options.counterUrl,forceUpdate:this.options.forceUpdate},e=this,i=a.fetch(this.service,this.options.url,t);i.reject=i.resolve=function(t){e.updateCounter(t)}}},cloneDataAttrs:function(t,e){for(var i=0;i<t.attributes.length;i++)"data-"==t.attributes[i].name.substr(0,5)&&e.setAttribute(t.attributes[i].name,t.attributes[i].value)},getElementClassNames:function(t){return d(t,this.service)},updateCounter:function(e){e=parseInt(e,10)||0;var i=document.createElement("span");e||this.options.zeroes?(i.innerHTML=e,i.className=this.getElementClassNames("counter")):i.className=this.getElementClassNames("counter")+" "+t+"__counter_empty",this.widget.appendChild(i);var n=this.widget["on_counter."+t];n&&n([this.service,e])},click:function(t){var e=this.options,i=!0;if("function"==typeof e.click&&(i=e.click.call(this,t)),i){var n=h(e.popupUrl,{url:e.url,title:e.title,image:e.image||""});n=this.addAdditionalParamsToUrl(n),this.openPopup(n,{width:e.popupWidth,height:e.popupHeight})}return!1},addAdditionalParamsToUrl:function(t){var e=p(this.widget);for(var i in this.options.data)e[i]=this.options.data[i];var n="";for(i in e)n+="&"+encodeURIComponent(i)+"="+encodeURIComponent(e[i]);return n?(t.indexOf("?")||(n="?"+n.substr(1)),t+n):t},openPopup:function(e,i){var n=Math.round(screen.width/2-i.width/2),o=0;screen.height>i.height&&(o=Math.round(screen.height/3-i.height/2));var r=window.open(e,"sl_"+this.service,"left="+n+",top="+o+",width="+i.width+",height="+i.height+",personalbar=0,toolbar=0,scrollbars=1,resizable=1");if(r){r.focus();var s=this.widget["on_popup_opened."+t];s&&s([this.service,r]);var a=this,u=setInterval((function(){if(r.closed){clearInterval(u);var e=a.widget["on_popup_closed."+t];e&&e(a.service)}}),this.options.popupCheckInterval)}else location.href=e}};for(var f=document.querySelectorAll("."+t),m=0;m<f.length;m++)window.socialLikes(f[m])}()}),2e3)}));