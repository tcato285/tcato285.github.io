!function(e,i){"use strict";function o(e){if("false"===e)return!1;var i=e.match(/(http:|https:|)\/\/(player.|www.)?(vimeo\.com|youtu(be\.com|\.be|be\.googleapis\.com))\/(video\/|embed\/|watch\?v=|v\/)?([A-Za-z0-9._%-]*)(&\S+)?/);return i&&/youtube/g.test(i[3])?"youtube":!(!i||!/vimeo/g.test(i[3]))&&"vimeo"}function a(e){if("false"===e)return!1;var i=e.match(/(http:|https:|)\/\/(player.|www.)?(vimeo\.com|youtu(be\.com|\.be|be\.googleapis\.com))\/(video\/|embed\/|watch\?v=|v\/)?([A-Za-z0-9._%-]*)(&\S+)?/);return!!i&&i[6]}function r(e,i){return"https://img.youtube.com/vi/"+e+"/"+(i||"")+"default.jpg"}function n(e,i){var o=new XMLHttpRequest;o.open("GET","https://vimeo.com/api/v2/video/"+e+".json",!0),o.onreadystatechange=function(){if(4===this.readyState&&this.status>=200&&this.status<400){var e=JSON.parse(this.responseText);i(e[0].thumbnail_large,e[0].thumbnail_small)}},o.send(),o=null}var t,c=(t={},function(i){var o=e.Deferred();return i in t?t[i]?o.resolve(t[i]):o.reject("Preview image not found."):e("<img>").on("load",(function(){if(120===(this.naturalWidth||this.width)){var e=this.src.split("/").pop();switch(e){case"maxresdefault.jpg":this.src=this.src.replace(e,"sddefault.jpg");break;case"sddefault.jpg":this.src=this.src.replace(e,"hqdefault.jpg");break;case"hqdefault.jpg":this.src=this.src.replace(e,"default.jpg");break;default:t[i]=null,o.reject("Preview image not found.")}}else o.resolve(t[i]=this.src)})).attr("src",r(i,"maxres")),o});function s(r){var t=i.$template.find("[data-app-component-id="+r._id+"] > .app-component-content section [mbr-carousel]"),s=t.attr("mbr-carousel");e(r._params[s]).each((function(s,d){var u=t.find(".carousel-item").eq(s);if(this.playVideo){var m=o(this.videoUrl),p=a(this.videoUrl),l=e('<div class="mbr-background-video-preview"></div>').css({display:"none",backgroundSize:"cover",backgroundPosition:"center"});i.isSecondaryComponent(r._id)?(t.find(".carousel-item").eq(s).find(".container-slide").parent().find(".mbr-background-video-preview").remove(),t.find(".carousel-item").eq(s).find(".container-slide").before(l)):t.find(".carousel-item").eq(s).find(".mbr-overlay").before(l),"youtube"===m?c(p).done((function(e){t.find(".carousel-item").eq(s).find(".mbr-background-video-preview").css("background-image","url("+e+")").show()})):"vimeo"===m&&n(p,(function(e,i){t.find(".carousel-item").eq(s).find(".mbr-background-video-preview").css("background-image","url("+e+")").show()})),u.find(".image_wrapper img").css("opacity","0"),u.find(".image_wrapper .mbr-overlay").css("display","none")}else u.find(".mbr-background-video-preview").remove(),u.css("background-image",'url("'+this.image+'")'),u.find(".image_wrapper img").css("opacity","1"),this.overlay&&u.find(".image_wrapper .mbr-overlay").css("display","block")}))}i.regExtension({name:"sliders",events:{load:function(){var t=this;t.on("preparedComponentParams",(function(i){var o=t.$template.find("[data-app-component-id="+i+"] > .app-component-content section [mbr-carousel]"),a=o.find(".carousel-item.active").index();o.length&&e(".image-tabs .images ul li").eq(a).click()})),t.Core.on("loadedComponent",(function(i,o,a,r){s(i),e(document).off("sortstop").on("sortstop",(function(){s(i)}))})),t.Core.on("addComponentParamsTab",(function(e){s(t.Core.getComponent(e))})),t.Core.addFilter("changeComponentParams",(function(s,d,u,m){t.Core.getComponent(m);var p=t.$template.find("[data-app-component-id="+m+"] > .app-component-content section [mbr-carousel]"),l=p.attr("mbr-carousel");if(d===l){var v=Object.keys(s);if(1===v.length){var f=s[v[0]];if("playVideo"in f||"videoUrl"in f){var b=t.$body.find("#edit-component-params").find(".image-tabs li.active"),g=u[l][b.index()],h=o(g.videoUrl),y=a(g.videoUrl);if("playVideo"in f)if(f.playVideo){if(p.find(".carousel-item.active .image_wrapper img").css("opacity","0"),p.find(".carousel-item.active .image_wrapper .mbr-overlay").css("display","none"),y){var w=e('<div class="mbr-background-video-preview"></div>').css({display:"none",backgroundSize:"cover",backgroundPosition:"center"});i.isSecondaryComponent(m)?e(".container-slide",p.find(".carousel-item.active")).before(w):e(".mbr-overlay, .container-slide",p.find(".carousel-item.active")).before(w),"youtube"===h?(b.css("background-image","url("+r(y)+")"),c(y).done((function(e){p.find(".carousel-item.active .mbr-background-video-preview").css("background-image","url("+e+")").show()}))):n(y,(function(e,i){b.css("background-image","url("+i+")"),p.find(".carousel-item.active .mbr-background-video-preview").css("background-image","url("+e+")").show()}))}}else{p.find(".carousel-item.active .image_wrapper img").css("opacity","1"),p.find(".carousel-item.active .image_wrapper .mbr-overlay").css("display","block"),p.find(".carousel-item.active .mbr-background-video-preview").remove();var k=i.core2path(g.image);b.css("background-image",'url("'+k+'")')}"videoUrl"in f&&y&&("youtube"===h?(b.css("background-image","url("+r(y)+")"),c(y).done((function(e){p.find(".carousel-item.active .mbr-background-video-preview").css("background-image","url("+e+")").show()}))):n(y,(function(e,i){b.css("background-image","url("+i+")"),p.find(".carousel-item.active .mbr-background-video-preview").css("background-image","url("+e+")").show()})))}}}return s}))},preparedComponentParams:function(t){!function(t){var c=i.$template.find("[data-app-component-id="+t._id+"] > .app-component-content section").find("[mbr-carousel]").attr("mbr-carousel");c&&i.$body.find("#edit-component-params").find(".image-tabs li:not(.add-item)").each((function(i,s){var d=t._params[c][i];if(d&&d.playVideo){var u=o(d.videoUrl),m=a(d.videoUrl);m&&("youtube"===u?e(s).css("background-image","url("+r(m)+")"):n(m,(function(i,o){e(s).css("background-image","url("+o+")")})))}}))}(i.Core.getComponent(t))}}})}(jQuery,mbrApp);